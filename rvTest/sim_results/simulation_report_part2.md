## 2. IF 取指阶段

### 2.1 模块功能
IF阶段包含PC和NPC模块，负责生成指令地址。

### 2.2 关键信号

| 信号 | 含义 |
|-----|------|
| pc | 当前程序计数器 |
| npc | 下一条指令地址 |
| pc4 | PC+4 |
| npc_op | 跳转类型选择 |
| data_hazard | 数据冒险，PC暂停 |
| control_hazard | 控制冒险，PC跳转 |

### 2.3 测试用例结果

1. **顺序执行**: PC从0x04递增到0x0C，NPC=PC+4
2. **分支跳转**: BEQ成功时NPC=PC+offset-8
3. **无条件跳转**: JAL/JALR直接跳转
4. **冒险处理**: 
   - data_hazard=1时PC保持不变
   - control_hazard=1时PC立即更新

![IF阶段波形](if_wave.svg)

---

## 3. ID 译码阶段

### 3.1 模块功能
ID阶段包含RF(寄存器堆)和SEXT(符号扩展)模块。

### 3.2 寄存器堆测试

| 操作 | 寄存器 | 数据 | 结果 |
|-----|-------|------|------|
| 写入 | x1 | 0x1111 | 成功 |
| 写入 | x2 | 0x2222 | 成功 |
| 写入 | x0 | 0xFFFF | 无效(x0恒为0) |
| 读取 | x0 | - | 0x0000 |
| 读取 | x1 | - | 0x1111 |

### 3.3 SEXT符号扩展测试

| 类型 | 输入 | 输出 | 说明 |
|-----|------|------|------|
| I型 | 0x7FF | 0x000007FF | 正数扩展 |
| I型 | 0xFFF | 0xFFFFFFFF | 负数扩展 |
| S型 | - | 12位符号扩展 | |
| B型 | - | 13位符号扩展 | |
| U型 | - | 高20位 | |
| J型 | - | 21位符号扩展 | |

![ID阶段波形](id_wave.svg)

---
