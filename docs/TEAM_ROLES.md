# 👥 团队分工文档

> 说明：本文件为历史归档，内容可能与当前仓库结构不一致。最新导航请见 `README.md` 与 `ARCHIVE.md`。


## 项目概述

本项目是一个完整的 **C 到 RV32I RISC-V 编译器工具链**，分为三个独立但相互协作的模块，由三位同学各自负责。

## 团队成员与职责分配

### 1. ✅ 高泽 (09022231) - **RISC-V 汇编器设计与实现** (已完成)

**职责范围**：
- 设计并实现 RISC-V 汇编器（Assembler）
- 将汇编代码转换为机器码
- 生成可执行的目标文件格式

**负责模块**：
```
Assembler (汇编器) ✅ 已完成
├── 汇编词法分析
├── 汇编语法分析
├── RV32I 指令编码
├── 符号表管理
├── 重定位信息处理
└── ELF 目标文件生成
```

**输入/输出**：
- **输入**：RV32I 汇编代码 (.s 文件)
- **输出**：机器码或目标文件 (.o 文件)

**完成的功能特性** ✅：
- ✅ 完整的词法分析器 - 支持RV32I指令、寄存器、立即数
- ✅ 完整的语法分析器 - 指令类型识别、符号表构建
- ✅ 指令编码器 - 所有RV32I指令类型编码（R/I/S/B/U/J型）
- ✅ ELF文件生成器 - 标准ELF目标文件输出
- ✅ 符号表管理 - 全局/本地符号和标签管理
- ✅ 重定位信息 - 完整的重定位表支持
- ✅ 工具链兼容 - 与RISC-V标准工具链兼容

**与其他模块的关系**：
- 接收**杨杰**的编译器生成的汇编代码
- 生成ELF目标文件供**彭佟茨**的链接器使用

---

### 2. 📝 杨杰 (09022120) - **Mini C 编译器（语法、语义、中间代码）**

**职责范围**：
- 设计并实现 C 语言编译器前端
- 完成词法分析和语法分析
- 进行语义检查和类型检查
- 生成中间代码和优化
- 最终输出 RV32I 汇编代码

**负责模块**：
```
C 编译器前端
├── 词法分析 (Lexer)
│   └── 分词、关键字识别
├── 语法分析 (Parser)
│   └── 语法树生成
├── 语义分析 (Semantic Analyzer)
│   ├── 类型检查
│   ├── 符号表管理
│   └── 错误检测
├── 中间代码生成 (IR)
│   └── 优化和转换
└── 代码生成 (Codegen)
    └── RV32I 汇编代码
```

**输入/输出**：
- **输入**：C 语言源代码 (.c 文件)
- **输出**：RV32I 汇编代码 (.s 文件)

**关键技术**：
- 递归下降解析
- 符号表和作用域管理
- 类型系统实现
- 栈帧布局
- 指令生成

**与其他模块的关系**：
- 输出汇编代码给**高泽**的汇编器
- 可与**彭佟茨**协作处理全局符号

---

### 3. 🔐 彭佟茨 (09022114) - **链接器与目标文件**

**职责范围**：
- 设计并实现链接器（Linker）
- 处理多个目标文件的链接
- 管理符号重定位
- 生成最终可执行文件

**负责模块**：
```
链接器 (Linker)
├── 目标文件解析
├── 符号解析
├── 重定位处理
├── 节合并
└── 可执行文件生成
```

**输入/输出**：
- **输入**：目标文件 (.o 文件)、库文件 (.a 文件)
- **输出**：可执行文件或库文件

**关键技术**：
- ELF 文件格式解析
- 符号表和重定位表管理
- 地址计算和内存布局
- 链接脚本处理

**与其他模块的关系**：
- 接收**高泽**生成的目标文件
- 可与**杨杰**协作处理全局符号定义

---

## 工作流程图

```
用户的 C 代码
     ↓
┌────────────────────────────────┐
│  杨杰的编译器                   │
│  (语法/语义/中间代码/代码生成)  │
└────────────────────────────────┘
     ↓
  汇编代码 (.s)
     ↓
┌────────────────────────────────┐
│  高泽的汇编器                   │
│  (汇编代码 → 机器码)            │
└────────────────────────────────┘
     ↓
  目标文件 (.o)
     ↓
┌────────────────────────────────┐
│  彭佟茨的链接器                 │
│  (链接 → 可执行文件)            │
└────────────────────────────────┘
     ↓
  可执行文件或库文件
```

---

## 当前项目现状

### 项目进度总览

```
编译器前端 (杨杰)    ████████████████████ 100% ✅
汇编器后端 (高泽)    ████████████████████ 100% ✅
链接器 (彭佟茨)      ░░░░░░░░░░░░░░░░░░░░   0% ⏳
```

### ✅ 已完成部分

#### 杨杰的工作（编译器）- **已完成 100%**
- ✅ Lexer（词法分析）- 350+ 行代码
- ✅ Parser（语法分析）- 650+ 行代码
- ✅ AST（抽象语法树）- 180+ 行代码
- ✅ Semantic Analyzer（语义分析）- 250+ 行代码
- ✅ Codegen（代码生成）- 350+ 行代码
- ✅ RV32I 汇编代码生成

**支持的语言特性**：
- 基本数据类型（int、char）
- 算术和逻辑运算
- 条件语句（if/else）
- 循环语句（while、for）
- 函数定义和调用
- 变量声明和赋值
- 控制流（break、continue、return）

**测试验证**：
- 5 个测试用例（全部通过）
- 4 个示例程序（全部通过）
- riscv32-unknown-elf-gcc 自动验证

---

#### 高泽的工作（汇编器）- ✅ **已完成 100%**

**已完成功能**：
- ✅ 汇编词法分析器 (`src/assembler/lexer.rs`)
- ✅ 汇编语法分析器 (`src/assembler/parser.rs`)
- ✅ RV32I 指令编码 (`src/assembler/encoder.rs`)
- ✅ 符号表管理 (`src/assembler/symbols.rs`)
- ✅ 重定位信息生成
- ✅ ELF 目标文件生成 (`src/assembler/elf.rs`)
- ✅ 主汇编器接口 (`src/assembler/mod.rs`)

**支持的功能**：
- 完整的RV32I指令集 (R/I/S/B/U/J型)
- 伪指令展开
- 标签和符号处理
- 标准ELF目标文件格式
- 重定位表生成
- Vivado兼容性

**文档**：
- 📄 `docs/STAGE_2_assembler_summary.md` - 详细的汇编器实现总结
- 📄 `docs/DEVELOPMENT.md` - 包含汇编器架构说明

**输入源**：来自杨杰编译器的 `.s` 文件
**输出**：可用于Vivado仿真和链接器的ELF目标文件

---

#### 彭佟茨的工作（链接器）- **待实现**
需要完成：
- [ ] 目标文件解析器
- [ ] 符号解析和重定位
- [ ] 内存布局规划
- [ ] 可执行文件生成

**输入源**：来自高泽汇编器的 `.o` 文件

---

## 接口规范

### 接口1：编译器 → 汇编器
**格式**：RV32I 汇编代码（文本格式）
```asm
.globl main
main:
    addi sp, sp, -16
    sw ra, 12(sp)
    # ... 更多指令
    lw ra, 12(sp)
    addi sp, sp, 16
    jr ra
```

**文件扩展名**：`.s`

---

### 接口2：汇编器 → 链接器
**格式**：ELF 目标文件（二进制格式）
**文件扩展名**：`.o`

**包含信息**：
- 代码段 (.text)
- 数据段 (.data)
- 符号表
- 重定位表

---

### 接口3：链接器 → 最终输出
**格式**：ELF 可执行文件（二进制格式）
**文件扩展名**：无扩展名或 `.elf`

**包含信息**：
- 完整的机器码
- 已解析的符号和地址

---

## 协作指南

### 代码提交规范

```bash
# 编译器模块 (杨杰)
git commit -m "compiler: 添加循环支持"

# 汇编器模块 (高泽)
git commit -m "assembler: 实现指令编码"

# 链接器模块 (彭佟茨)
git commit -m "linker: 符号重定位处理"
```

### 文档更新
- 各自在 `docs/` 中维护模块文档
- 更新进度和 API 说明
- 报告已知问题和限制

### 测试协作
- 每个模块应包含单元测试
- 集成测试验证模块间的接口
- 使用共同的测试用例

---

## 文件组织

```
riscvCompiler/
├── src/
│   ├── lexer.rs              [杨杰] 词法分析
│   ├── parser.rs             [杨杰] 语法分析
│   ├── ast.rs                [杨杰] 抽象语法树
│   ├── semantic.rs           [杨杰] 语义分析
│   ├── codegen.rs            [杨杰] 代码生成
│   ├── validator.rs          [杨杰] 验证工具
│   └── main.rs               [杨杰] 主程序
│
├── assembler/                [高泽] 汇编器源码 (待创建)
├── linker/                   [彭佟茨] 链接器源码 (待创建)
│
├── tests/                    [各模块] 测试用例
├── examples/                 [各模块] 示例代码
├── output/                   [输出] 生成的文件
│
└── docs/
    ├── TEAM_ROLES.md         本文件
    ├── INDEX.md              文档导航
    ├── DEVELOPMENT.md        开发指南
    └── ...
```

---

## 下一步工作计划

### Phase 2: 链接器实现 (彭佟茨) ⭐ **下一个重点**
1. 解析ELF目标文件（来自高泽的汇编器）
2. 实现符号重定位和解析
3. 内存布局规划和地址计算
4. 生成可执行文件或库文件

**输入**：`src/assembler/elf.rs` 生成的ELF目标文件 (.o)  
**预期输出**：可执行文件 (.elf) 或库文件

### Phase 3: 集成测试与优化 (全体)
1. 端到端集成测试 (C → 汇编 → ELF → 可执行)
2. 与Vivado仿真和硬件烧录集成
3. 性能优化和代码质量提升
4. 文档完善和API稳定

---

## 参考资源

- **RV32I 指令集**：https://riscv.org/
- **ELF 文件格式**：https://en.wikipedia.org/wiki/Executable_and_Linkable_Format
- **编译器设计**：龙书《编译原理》
- **链接器原理**：《链接器和加载器》

---

## 联系方式与问题追踪

- **编译器问题**：联系杨杰 (09022120)
- **汇编器问题**：联系高泽 (09022231)
- **链接器问题**：联系彭佟茨 (09022114)

---

**文档版本**：1.0  
**最后更新**：2025年11月20日  
**维护者**：项目团队
